# blackbox coverage matrix: brief.compress

distilled from the blackbox criteria into combination matrices for gap analysis.

---

## matrix 1: core compression flow (single file)

covers usecase.1 and usecase.6 ‚Äî core path through compression for a single file.

| ind: file state | ind: mode | ind: model | dep: emits .md.min | dep: shows stats | dep: shows diff | dep: exit status |
|-----------------|-----------|------------|--------------------|--------------------|-----------------|------------------|
| found, markdown | apply | available | yes | yes | no | 0 |
| found, markdown | plan | available | no | yes | yes | 0 |
| found, markdown | apply | not available | no | no | no | non-zero |
| found, markdown | plan | not available | no | no | no | non-zero |
| not found | apply | available | no | no | no | non-zero |
| not found | plan | available | no | no | no | non-zero |
| not markdown | apply | available | no | no | no | non-zero |
| not markdown | plan | available | no | no | no | non-zero |

**gaps**: none ‚Äî all meaningful combinations covered.

---

## matrix 2: staleness handler

covers usecase.5 ‚Äî behavior when collocated .md.min already present.

| ind: source mtime vs .md.min | ind: --force | dep: recompresses | dep: overwrites .md.min | dep: reported status |
|------------------------------|--------------|-------------------|-------------------------|----------------------|
| source newer (stale) | false | yes | yes | "recompressed" |
| source newer (stale) | true | yes | yes | "recompressed" |
| source older/equal (fresh) | false | no | no | "up-to-date" |
| source older/equal (fresh) | true | yes | yes | "recompressed" |

**gaps**: none ‚Äî all combinations covered.

**note**: when no .md.min is present, staleness check is skipped and compression proceeds.

---

## matrix 3: validation flow

covers usecase.3 ‚Äî behavioral equivalence validation.

| ind: --validate | ind: validation result | ind: mode | dep: runs validation | dep: emits .md.min | dep: shows degradations |
|-----------------|------------------------|-----------|----------------------|--------------------|-------------------------|
| false | n/a | apply | no | yes | no |
| false | n/a | plan | no | no | no |
| true | pass | apply | yes | yes | no |
| true | pass | plan | yes | no | no |
| true | fail | apply | yes | no | yes |
| true | fail | plan | yes | no | yes |

**gaps**: none ‚Äî all combinations covered.

**decomposition signal**: the interaction of --validate √ó mode √ó result is clean (3 dimensions). no decomposition needed.

---

## matrix 4: ratio control

covers usecase.4 ‚Äî compression ratio control and alerts.

| ind: --ratio value | dep: targets ratio | dep: alerts quality risk | dep: recommends --validate |
|--------------------|--------------------|-----------------------|---------------------------|
| 1-4 (safe) | yes | no | no |
| 5-10 (moderate) | yes | no | no |
| 11-20 (aggressive) | yes | yes | yes |

**gaps**:
- criteria does not specify behavior for ratio=0 (below minimum) ‚Äî inferred: clamp to 1 with alert
- criteria does not specify behavior for ratio>20 (above maximum) ‚Äî inferred: clamp to 20 with alert

**recommendation**: add explicit boundary condition criteria for out-of-range ratios.

---

## matrix 5: glob flow

covers usecase.2 ‚Äî batch compression via glob pattern.

| ind: input type | ind: match result | dep: enumerates files | dep: processes each | dep: aggregate stats | dep: exit status |
|-----------------|-------------------|----------------------|---------------------|----------------------|------------------|
| path | n/a | no | single file | no | per file |
| glob | files matched | yes | yes | yes | 0 |
| glob | no files matched | yes | no | no | 0 (informative message) |

**gaps**: none ‚Äî all combinations covered.

**note**: glob with no matches exits 0 with informative message (not treated as error).

---

## matrix 6: combined flag interactions

cross-domain check for flag combinations not explicitly covered.

| ind: --mode | ind: --validate | ind: --force | ind: --ratio | covered? |
|-------------|-----------------|--------------|--------------|----------|
| apply | false | false | default | yes (uc1) |
| apply | false | true | default | yes (uc5) |
| apply | true | false | default | yes (uc3) |
| apply | true | true | default | inferred |
| apply | false | false | aggressive | yes (uc4) |
| apply | true | false | aggressive | inferred |
| plan | false | false | default | yes (uc1) |
| plan | true | false | default | yes (uc3) |
| plan | false | true | default | inferred |

**gaps flagged**:
- `--validate --force` combination: not explicitly specified. inferred behavior: force recompress, then validate.
- `--validate --ratio 20` combination: not explicitly specified. inferred behavior: validate after aggressive compression.
- `--force --mode plan` combination: not explicitly specified. is force meaningful in plan mode?

**recommendation**: clarify whether --force applies to plan mode, or is only meaningful with apply.

---

## decomposition analysis

| usecase | dimensions | combination count | decomposition needed? |
|---------|------------|-------------------|----------------------|
| uc1: single file | 3 (file state, mode, model) | 8 | no |
| uc2: glob | 2 (input type, match result) | 3 | no |
| uc3: validation | 3 (validate, result, mode) | 6 | no |
| uc4: ratio | 1 (ratio range) | 3 | no |
| uc5: staleness | 2 (mtime, force) | 4 | no |
| uc6: errors | 3 (file state, model, input) | covered in uc1 | merged |
| cross-domain | 4 (mode, validate, force, ratio) | 16+ | **yes ‚Äî review** |

**decomposition signal**: the cross-domain flag interaction matrix (matrix 6) has 4+ dimensions. this suggests the cli surface may benefit from:
- clearer documentation of flag precedence
- explicit error/alert for flags in conflict
- or acceptance that some combinations are "inferred" rather than explicitly specified

---

## summary of gaps

| gap | location | recommendation |
|-----|----------|----------------|
| ratio < 1 or > 20 | matrix 4 | add boundary criteria: clamp with alert |
| --validate --force | matrix 6 | clarify: validate after forced recompression |
| --validate --ratio 20 | matrix 6 | clarify: aggressive ratio with validation |
| --force --mode plan | matrix 6 | clarify: is force meaningful in plan mode? |

---

üê¢ matrices reveal gaps that prose hides üåä
