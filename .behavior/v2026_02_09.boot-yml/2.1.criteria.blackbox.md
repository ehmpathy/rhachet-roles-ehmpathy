# blackbox criteria: boot.yml for mechanic role

## usecase.1 = boot.yml declares brief-to-subject clusters with say/ref modes

```
given('a boot.yml file on the mechanic role')
  given('the boot.yml declares subjects: always, subject.prod, subject.test, subject.arch, subject.flow')
    given('each brief in boot.yml has a mode of say or ref')

      when('roles boot is invoked without --subject')
        then('only the "always" subject briefs are booted')
          sothat('default boot is minimal and focused')
        then('say briefs are injected with full content')
        then('ref briefs are injected as path-only links')

      when('roles boot is invoked with --subject test')
        then('the "always" subject briefs are booted')
        then('the "subject.test" briefs are booted')
        then('no other subject briefs are booted')
          sothat('context is focused on test-relevant knowledge')

      when('roles boot is invoked with --subject prod')
        then('the "always" subject briefs are booted')
        then('the "subject.prod" briefs are booted')
        then('no other subject briefs are booted')

      when('roles boot is invoked with --subject arch')
        then('the "always" subject briefs are booted')
        then('the "subject.arch" briefs are booted')
        then('no other subject briefs are booted')

      when('roles boot is invoked with --subject prod --subject test')
        then('the "always" subject briefs are booted')
        then('the "subject.prod" briefs are booted')
        then('the "subject.test" briefs are booted')
        then('no other subject briefs are booted')
          sothat('multiple subjects compose cleanly')
```

## usecase.2 = say vs ref mode controls injection depth

```
given('a boot.yml with briefs declared as say or ref')

  when('a brief is declared as say')
    then('the full content of the brief is injected into context')
      sothat('the mechanic internalizes core rules without a need to look them up')

  when('a brief is declared as ref')
    then('only the brief path is injected as a reference link')
    then('the full content is not injected')
      sothat('context tokens are preserved for heavy reference docs, demos, and lessons')
    then('the mechanic can still access the full content by read of the file path')
      sothat('ref briefs remain accessible on demand')
```

## usecase.3 = brief overlap across subjects

```
given('a brief appears in multiple subjects with different modes')
  given('rule.require.bounded-contexts is ref in subject.prod')
  given('rule.require.bounded-contexts is say in subject.arch')

  when('roles boot is invoked with --subject prod')
    then('bounded-contexts is booted as ref (path only)')

  when('roles boot is invoked with --subject arch')
    then('bounded-contexts is booted as say (full content)')

  when('roles boot is invoked with --subject prod --subject arch')
    then('bounded-contexts is booted as say (full content)')
      sothat('say takes precedence over ref when both subjects are booted')
```

## usecase.4 = token reduction is observable

```
given('the mechanic role has ~102 briefs with a total of ~61k tokens')

  when('roles boot is invoked without --subject (always only)')
    then('the booted token count is ~4k')
      sothat('minimal sessions are cheap and fast')

  when('roles boot is invoked with --subject test')
    then('the booted token count is ~10k')
      sothat('test-focused work uses ~84% fewer tokens than full boot')

  when('roles boot is invoked with --subject prod')
    then('the booted token count is ~20k')
      sothat('prod-focused work uses ~67% fewer tokens than full boot')

  when('roles boot is invoked with --subject prod --subject test')
    then('the booted token count is ~25k')
      sothat('combined subjects still use ~59% fewer tokens than full boot')
```

## usecase.5 = fail-fast on invalid state

```
given('a boot.yml on the mechanic role')

  when('a brief file referenced in boot.yml does not exist on disk')
    then('boot fails with a clear error message')
    then('the error identifies which brief path is absent')
      sothat('stale boot.yml entries are caught immediately')

  when('roles boot is invoked with --subject nonexistent')
    then('boot fails with a clear error message')
    then('the error identifies the unrecognized subject name')
      sothat('typos and outdated subject names are caught immediately')
```

## usecase.6 = every brief is accounted for

```
given('a boot.yml on the mechanic role')
  given('the role has briefs on disk')

  when('a brief file exists in the briefs directory but is not listed in boot.yml')
    then('boot warns that the brief is unaccounted for')
      sothat('new briefs are not silently left out of all subjects')
```
