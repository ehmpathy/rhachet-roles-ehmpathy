# blueprint v1: boot.yml for mechanic role

## scope

this repo (rhachet-roles-ehmpathy) owns the mechanic role definition. the deliverable is a `boot.yml` file that declares subject clusters and say/ref modes for the mechanic's ~102 briefs.

rhachet (the framework) consumes the boot.yml at boot time. this blueprint covers only the changes within this repo — not changes to rhachet itself.

## filediff treestruct

```
src/domain.roles/mechanic/
  [+] boot.yml                              # the boot.yml declaration

src/domain.roles/mechanic/briefs/
  [○] practices/                            # all brief files retained as-is

src/domain.roles/mechanic/getMechanicRole.ts
  [~] update                                # add boot: { uri } to ROLE_MECHANIC

package.json
  [~] update                                # bump rhachet to >=1.33.0 (boot.yml support via PR #223)
```

**legend:** `[+]` create, `[~]` update, `[○]` retain, `[-]` delete

**note:** `rhachet.repo.yml` is auto-generated via `npx rhachet repo introspect` — no manual update needed. the `boot` attribute on `ROLE_MECHANIC` will be introspected into the manifest automatically.

## codepath treestruct

```
src/domain.roles/mechanic/boot.yml
  [+] always                                # ~21 briefs: identity, language, tones
  [+] subject.code.prod                          # ~52 briefs: production code practices
  [+] subject.code.test                          # ~16 briefs: test code practices
  [+] subject.arch                          # ~9 briefs: architecture & domain design
  [+] subject.flow                          # ~10 briefs: workflow, tools, diagnostics

src/domain.roles/mechanic/getMechanicRole.ts
  [~] ROLE_MECHANIC.boot                    # add boot: { uri: `${__dirname}/boot.yml` }
```

## contracts

### boot.yml schema

the boot.yml schema is defined by rhachet's `RoleBootSpec` (PR #223). each top-level key is a subject. within each subject, `briefs` and `skills` sections declare `say` (full content) and `ref` (path-only) glob arrays.

```yaml
# src/domain.roles/mechanic/boot.yml

always:
  briefs:
    say:
      # identity & tone
      - practices/lang.tones/rule.im_an.ehmpathy_seaturtle.md
      - practices/lang.tones/rule.prefer.lowercase.md
      - practices/lang.tones/rule.require.term-human.md
      - practices/lang.tones/rule.prefer.chill-nature-emojis.md
      - practices/lang.tones/rule.forbid.buzzwords.md
      - practices/lang.tones/rule.forbid.shouts.md
      - practices/lang.tones/define.why-seaturtles-love-software.md

      # foundational terms
      - practices/lang.terms/define.directives...md
      - practices/lang.terms/rule.forbid.gerunds.md
      - practices/lang.terms/rule.require.order.noun_adj.md
      - practices/lang.terms/rule.require.ubiqlang.md
      - practices/lang.terms/rule.require.treestruct.md

    ref:
      # term enforcement via hooks — ref only (hooks already block violations)
      - practices/lang.terms/rule.forbid.term-dryrun.md
      - practices/lang.terms/rule.forbid.term=dryrun.md
      - practices/lang.terms/rule.forbid.term=existing...md
      - practices/lang.terms/rule.forbid.term=normalize...md
      - practices/lang.terms/rule.forbid.term-script...md

      # supplements and references
      - practices/lang.terms/rule.prefer.term-supplier.md
      - practices/lang.terms/rule.require.order.noun_adj.md.pt2.md
      - practices/lang.terms/define.exec-vs-apply.md
      - practices/lang.terms/define.prodcode-testcode...md

subject.code.prod:
  briefs:
    say:
      # procedures
      - practices/code.prod/evolvable.procedures/rule.require.input-context-pattern.md.pt1.md
      - practices/code.prod/evolvable.procedures/rule.require.input-options-pattern.md
      - practices/code.prod/evolvable.procedures/rule.require.arrow-only.md
      - practices/code.prod/evolvable.procedures/rule.require.clear-contracts.md
      - practices/code.prod/evolvable.procedures/rule.require.dependency-injection.md.pt1.md
      - practices/code.prod/evolvable.procedures/rule.require.hook-wrapper-pattern.md
      - practices/code.prod/evolvable.procedures/rule.require.named-args.md
      - practices/code.prod/evolvable.procedures/rule.require.single-responsibility.md
      - practices/code.prod/evolvable.procedures/rule.forbid.io-as-domain-objects.md
      - practices/code.prod/evolvable.procedures/rule.forbid.io-as-interfaces.md
      - practices/code.prod/evolvable.procedures/rule.forbid.positional-args.md.pt1.md

      # domain objects
      - practices/code.prod/evolvable.domain.objects/rule.forbid.nullable-without-reason.md
      - practices/code.prod/evolvable.domain.objects/rule.forbid.undefined-attributes.md
      - practices/code.prod/evolvable.domain.objects/rule.require.immutable-refs.md

      # domain operations
      - practices/code.prod/evolvable.domain.operations/rule.require.sync-filename-opname.md

      # architecture
      - practices/code.prod/evolvable.architecture/rule.prefer.wet-over-dry.md
      - practices/code.prod/evolvable.architecture/rule.require.bounded-contexts.md
      - practices/code.prod/evolvable.architecture/rule.require.domain-driven-design.md

      # domain objects (reference)
      - practices/code.prod/evolvable.domain.objects/ref.package.domain-objects.[ref].md

      # persistence
      - practices/code.prod/readable.persistence/rule.prefer.declastruct.[demo].md

      # repo structure
      - practices/code.prod/evolvable.repo.structure/rule.forbid.barrel-exports.md
      - practices/code.prod/evolvable.repo.structure/rule.forbid.index-ts.md
      - practices/code.prod/evolvable.repo.structure/rule.require.directional-deps.md

      # errors
      - practices/code.prod/pitofsuccess.errors/rule.forbid.error-hiding.md.pt1.md
      - practices/code.prod/pitofsuccess.errors/rule.prefer.helpful-error-wrap.md
      - practices/code.prod/pitofsuccess.errors/rule.require.fail-fast.md

      # procedures (pit of success)
      - practices/code.prod/pitofsuccess.procedures/rule.forbid.nonidempotent-mutations.md
      - practices/code.prod/pitofsuccess.procedures/rule.forbid.undefined-inputs.md
      - practices/code.prod/pitofsuccess.procedures/rule.require.idempotent-procedures.md
      - practices/code.prod/pitofsuccess.procedures/rule.require.immutable-vars.md

      # typedefs
      - practices/code.prod/pitofsuccess.typedefs/rule.forbid.as-cast.md
      - practices/code.prod/pitofsuccess.typedefs/rule.require.shapefit.md

      # readability
      - practices/code.prod/readable.comments/rule.require.what-why-headers.md
      - practices/code.prod/readable.narrative/rule.require.narrative-flow.md
      - practices/code.prod/readable.narrative/rule.avoid.unnecessary-ifs.md
      - practices/code.prod/readable.narrative/rule.forbid.else-branches.md

      # artifacts
      - practices/code.prod/consistent.artifacts/rule.require.pinned-versions.md

    ref:
      # procedure supplements
      - practices/code.prod/evolvable.procedures/rule.require.input-context-pattern.md.pt2.md
      - practices/code.prod/evolvable.procedures/rule.require.dependency-injection.md.pt2.md
      - practices/code.prod/evolvable.procedures/rule.forbid.positional-args.md.pt2.md

      # domain operations
      - practices/code.prod/evolvable.domain.operations/define.domain-operation-core-variants.md

      # repo structure
      - practices/code.prod/evolvable.repo.structure/rule.prefer.dot-dirs.md

      # errors
      - practices/code.prod/pitofsuccess.errors/rule.forbid.error-hiding.md.pt2.md
      - practices/code.prod/pitofsuccess.errors/rule.require.fail-fast.[seed].md
      - practices/code.prod/pitofsuccess.errors/rule.require.fail-fast.[demo].shell.md

      # procedures
      - practices/code.prod/pitofsuccess.procedures/rule.require.idempotency.[seed].md
      - practices/code.prod/pitofsuccess.procedures/rule.require.pitofsuccess.md

      # typedefs
      - practices/code.prod/pitofsuccess.typedefs/define.bivariance-for-generics.[lesson].md

      # readability
      - practices/code.prod/readable.comments/rule.require.what-why-headers.v1.md
      - practices/code.prod/readable.narrative/rule.forbid.else-branches.[demo].md
      - practices/code.prod/readable.narrative/rule.prefer.early-returns.[demo].md
      - practices/code.prod/readable.narrative/rule.prefer.transformers-over-conditionals.[lesson].md

      # contracts
      - practices/code.prod/consistent.contracts/ref.package.as-command.[ref].md

subject.code.test:
  briefs:
    say:
      - practices/code.test/frames.behavior/rule.require.given-when-then.md
      - practices/code.test/frames.behavior/rule.require.useThen-useWhen-for-shared-results.md
      - practices/code.test/frames.behavior/rule.forbid.redundant-expensive-operations.md
      - practices/code.test/frames.caselist/rule.prefer.data-driven.md
      - practices/code.test/lessons.howto/howto.write.[lesson].md.pt1.md
      - practices/code.test/lessons.howto/howto.write.[lesson].md.pt2.md
      - practices/code.test/lessons.howto/howto.write.[lesson].md.pt3.md
      - practices/code.test/lessons.howto/rule.require.snapshots.[lesson].md
      - practices/code.test/scope.acceptance/rule.require.blackbox.md
      - practices/code.test/scope.unit/rule.forbid.remote-boundaries.md

    ref:
      - practices/code.test/consistent.contracts/ref.package.test-fns.[ref].md
      - practices/code.test/frames.behavior/howto.write-bdd.[lesson].md
      - practices/code.test/frames.behavior/howto.write-bdd.[lesson].pt2.md
      - practices/code.test/lessons.howto/howto.diagnose.[lesson].md
      - practices/code.test/lessons.howto/howto.run.[lesson].md
      - practices/code.test/lessons.howto/howto.use.[lesson].md

subject.arch:
  briefs:
    say:
      # all say in both arch and code.prod — overlap is intentional
      - practices/code.prod/evolvable.architecture/rule.prefer.wet-over-dry.md
      - practices/code.prod/evolvable.domain.objects/rule.forbid.nullable-without-reason.md
      - practices/code.prod/evolvable.domain.objects/rule.forbid.undefined-attributes.md
      - practices/code.prod/evolvable.domain.objects/rule.require.immutable-refs.md
      - practices/code.prod/evolvable.repo.structure/rule.require.directional-deps.md

subject.flow:
  briefs:
    say:
      - practices/work.flow/diagnose/rule.forbid.trust-vscode-diagnostics.md
      - practices/work.flow/refactor/rule.prefer.sedreplace-for-renames.md
      - practices/work.flow/refactor/rule.require.review-test-changes.md
      - practices/work.flow/tools/rule.prefer.terraform.md.pt1.md
      - practices/work.flow/tools/rule.require.externalized-knowledge.md
      - practices/work.flow/tools/rule.require.read-package-docs-before-use.md

    ref:
      - practices/work.flow/diagnose/howto.bisect.[lesson].md
      - practices/work.flow/tools/rule.prefer.allowlist-examples.[lesson].md
      - practices/work.flow/tools/rule.prefer.jq.[demo].md
      - practices/work.flow/tools/rule.prefer.terraform.md.pt2.md
```

### say/ref classification heuristic

| brief type | mode | rationale |
|---|---|---|
| `rule.require.*` | say | mandatory rules must be internalized |
| `rule.forbid.*` | say | mandatory rules must be internalized |
| `rule.prefer.*` | say | strong guidance, should be present |
| `rule.avoid.*` | say | strong guidance, should be present |
| `define.*` (short) | say | foundational definitions needed in context |
| `ref.package.*.[ref]` | ref | heavy reference docs, lookup on demand |
| `howto.*.[lesson]` | ref | lessons are reference material |
| `rule.*.[demo]` | ref | demos are reference material |
| `rule.*.[seed]` | ref | seeds are supplementary rationale |
| `*.pt2` (supplements) | ref | supplements are secondary detail |
| `*.v1` (old versions) | ref | old versions are backup reference |

### overlap across subjects

briefs can appear in multiple subjects. when the same brief is say in both, no resolution needed — say in both is consistent. the arch briefs (`bounded-contexts`, `domain-driven-design`, `domain-objects.[ref]`, `declastruct.[demo]`, `wet-over-dry`, `nullable-without-reason`, `undefined-attributes`, `immutable-refs`, `directional-deps`) are all say in both code.prod and arch.

## composition

```
boot.yml
  └── parsed by rhachet roles boot
        └── filters briefs by --subject flag(s)
              └── always + requested subject(s)
                    ├── say briefs → full <brief> content injection
                    └── ref briefs → path-only <brief> link injection
```

the boot.yml sits alongside the briefs/ directory in `src/domain.roles/mechanic/`. at build time, it is copied to `dist/domain.roles/mechanic/boot.yml`. at runtime, rhachet reads it from `.agent/repo=ehmpathy/role=mechanic/boot.yml` (via symlink to dist).

## getMechanicRole.ts update

add `boot: { uri }` to `ROLE_MECHANIC` so rhachet can discover the boot.yml via introspection:

```ts
// src/domain.roles/mechanic/getMechanicRole.ts
export const ROLE_MECHANIC: Role = Role.build({
  slug: 'mechanic',
  // ... (retained as-is)
  briefs: {
    dirs: { uri: `${__dirname}/briefs` },
  },
  boot: { uri: `${__dirname}/boot.yml` },          // [+] add boot.yml reference
  // ... (retained as-is)
});
```

**note:** `rhachet.repo.yml` is auto-generated via `npx rhachet repo introspect` from this role definition. the `boot` attribute on `RoleManifest` (`boot?: { uri: string }`) will be populated automatically. no manual edit of `rhachet.repo.yml` is needed.

## test coverage

### unit tests

```
[+] src/domain.roles/mechanic/boot.yml.test.ts
    - validate that every brief path in boot.yml resolves to a file on disk
    - validate that every brief file in briefs/ appears in at least one subject
    - validate that no brief appears in the same subject twice
    - validate yml syntax is valid
```

### integration tests

```
[+] src/domain.roles/mechanic/boot.yml.integration.test.ts
    - validate that `npx rhachet roles boot --repo ehmpathy --role mechanic` succeeds
    - validate that `npx rhachet roles boot --repo ehmpathy --role mechanic --subject test`
      boots only always + test briefs
    - validate that say briefs emit full content
    - validate that ref briefs emit path-only links
    - validate that unrecognized --subject flags fail fast
```

## dependencies

- rhachet >=1.33.0 required (boot.yml support via PR #223, confirmed merged)
- boot.yml schema: top-level subjects with `briefs: { say: [...], ref: [...] }` — confirmed via PR #223 test assets
- default boot behavior: when `--subject` is absent, all subjects are booted (not just always)
- build step: `build:complete:dist` rsync in package.json must add `**/*.yml` include — currently only copies `*.md`, `*.sh`, `*.jsonc`
