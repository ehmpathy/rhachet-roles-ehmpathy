# roadmap v1: boot.yml for mechanic role

## phase 0: bump rhachet

### prereqs
- read: `.behavior/v2026_02_09.boot-yml/3.3.blueprint.v1.i1.md` (dependencies section)

### checklist
- [ ] bump rhachet to >=1.33.0 in package.json
- [ ] run `pnpm install --frozen-lockfile` (or regenerate lockfile if needed)
- [ ] verify rhachet version: `npm list rhachet`

### acceptance
- `npm list rhachet` shows >=1.33.0
- `npm run build` still passes

### verify
```sh
npm list rhachet
npm run build
```

---

## phase 1: create boot.yml

### prereqs
- phase 0 complete
- read: `.behavior/v2026_02_09.boot-yml/3.3.blueprint.v1.i1.md` (boot.yml schema section)

### checklist
- [ ] create `src/domain.roles/mechanic/boot.yml` with all subjects and brief paths per blueprint
  - always (identity, language, tones)
  - subject.code.prod (procedures, domain objects, architecture, errors, types, readability)
  - subject.code.test (bdd, given-when-then, data-driven, howtos)
  - subject.arch (architecture, domain design â€” overlap with code.prod)
  - subject.flow (workflow, tools, diagnostics)
- [ ] verify yaml syntax is valid: `npx js-yaml src/domain.roles/mechanic/boot.yml` or equivalent

### acceptance
- boot.yml parses as valid yaml
- every brief path listed resolves to a file on disk
- every brief file in `src/domain.roles/mechanic/briefs/` appears in at least one subject

### verify
```sh
# yaml syntax
node -e "const y = require('js-yaml'); const fs = require('fs'); y.load(fs.readFileSync('src/domain.roles/mechanic/boot.yml', 'utf8')); console.log('valid yaml')"
```

---

## phase 2: update build config

### prereqs
- phase 1 complete
- read: `.behavior/v2026_02_09.boot-yml/3.3.blueprint.v1.i1.md` (dependencies section â€” build step note)

### checklist
- [ ] add `--include='**/*.yml'` to `build:complete:dist` rsync in package.json
- [ ] run `npm run build`
- [ ] verify `dist/domain.roles/mechanic/boot.yml` exists after build

### acceptance
- `npm run build` succeeds
- `dist/domain.roles/mechanic/boot.yml` exists and matches src

### verify
```sh
npm run build
diff src/domain.roles/mechanic/boot.yml dist/domain.roles/mechanic/boot.yml
```

---

## phase 3: update getMechanicRole.ts

### prereqs
- phase 2 complete
- read: `.behavior/v2026_02_09.boot-yml/3.3.blueprint.v1.i1.md` (getMechanicRole.ts update section)

### checklist
- [ ] add `boot: { uri: \`${__dirname}/boot.yml\` }` to `ROLE_MECHANIC` in `src/domain.roles/mechanic/getMechanicRole.ts`
- [ ] run `npm run build`
- [ ] run `npx rhachet repo introspect` to regenerate `rhachet.repo.yml`
- [ ] verify `rhachet.repo.yml` now includes `boot` attribute for mechanic role

### acceptance
- `getMechanicRole.ts` compiles without type errors
- `rhachet.repo.yml` includes `boot: { uri: ... }` for mechanic
- `npm run test:types` passes

### verify
```sh
npm run build
npm run test:types
grep -A2 'boot' rhachet.repo.yml
```

---

## phase 4: unit tests

### prereqs
- phase 3 complete
- read: `.behavior/v2026_02_09.boot-yml/3.3.blueprint.v1.i1.md` (test coverage â€” unit tests section)
- read: `.behavior/v2026_02_09.boot-yml/2.1.criteria.blackbox.md` (usecase.5 and usecase.6)

### checklist
- [ ] create `src/domain.roles/mechanic/boot.yml.test.ts`
- [ ] test: every brief path in boot.yml resolves to a file on disk
- [ ] test: every brief file in `briefs/` appears in at least one subject
- [ ] test: no brief appears in the same subject twice (same say/ref list)
- [ ] test: yml syntax is valid
- [ ] run unit tests

### acceptance
- all unit tests pass
- coverage validates boot.yml integrity against disk state

### verify
```sh
npm run test:unit -- boot.yml.test
```

---

## phase 5: integration tests

### prereqs
- phase 4 complete
- read: `.behavior/v2026_02_09.boot-yml/3.3.blueprint.v1.i1.md` (test coverage â€” integration tests section)
- read: `.behavior/v2026_02_09.boot-yml/2.1.criteria.blackbox.md` (all usecases)

### checklist
- [ ] create `src/domain.roles/mechanic/boot.yml.integration.test.ts`
- [ ] test: `npx rhachet roles boot --repo ehmpathy --role mechanic` succeeds (boots all subjects)
- [ ] test: `npx rhachet roles boot --repo ehmpathy --role mechanic --subject code.test` boots only always + code.test briefs
- [ ] test: say briefs emit full content
- [ ] test: ref briefs emit path-only links
- [ ] test: `--subject nonexistent` fails fast with clear error
- [ ] run integration tests

### acceptance
- all integration tests pass
- boot output matches expected brief selection and injection depth

### verify
```sh
npm run test:integration:non-cicd -- boot.yml.integration.test
```

---

## phase 6: full validation

### prereqs
- phase 5 complete

### checklist
- [ ] run full test suite: `npm run test`
- [ ] run full build: `npm run build`
- [ ] manual smoke test: `npx rhachet roles boot --repo ehmpathy --role mechanic --subject code.prod`

### acceptance
- all tests pass (types, lint, format, unit, integration)
- build succeeds
- boot produces expected output with say/ref depth

### verify
```sh
npm run build
npm run test
npx rhachet roles boot --repo ehmpathy --role mechanic --subject code.prod 2>&1 | head -50
```
