# blackbox criteria: get.package.docs

## usecase.1 = fetch readme for a package

```
given('a package name')
  when('readme exists in node_modules')
    then('readme content is returned')
      sothat('mechanic sees docs for installed version')
    then('readme is cached to .refs/get.package.docs/$package.$version.readme.md')
      sothat('subsequent calls are instant')

  when('readme not in node_modules but cached')
    then('cached readme content is returned')
      sothat('no network required for repeat calls')

  when('readme not in node_modules, not cached, but available via npm api')
    then('readme content is fetched from npm registry')
    then('readme is cached to .refs/get.package.docs/$package.$version.readme.md')
    then('readme content is returned')
      sothat('mechanic gets docs even when not bundled')

  when('readme not found anywhere')
    then('clear error message is returned')
    then('suggestion to use filetree subcommand is shown')
      sothat('mechanic has a fallback path')

  when('package not installed in node_modules')
    then('error: "package not found in node_modules. install it first."')
      sothat('mechanic knows to install before fetch')
```

## usecase.2 = fetch filetree for a package

```
given('a package name')
  when('package exists in node_modules')
    then('directory tree of node_modules/$package is returned')
      sothat('mechanic can explore package contents')

  when('package not installed in node_modules')
    then('error: "package not found in node_modules. install it first."')
      sothat('mechanic knows to install before fetch')
```

## usecase.3 = cache directory bootstrap

```
given('first use of get.package.docs skill')
  when('.refs/get.package.docs/ does not exist')
    then('directory is created')
    then('.refs/get.package.docs/.gitignore is created with content "*"')
      sothat('cache stays out of git')
```

## usecase.4 = version-aware cache

```
given('package iso-price@1.0.0 readme is cached')
  when('package is upgraded to iso-price@1.1.0')
    when('readme is requested')
      then('cache miss occurs (version mismatch)')
      then('fresh readme is fetched for 1.1.0')
      then('new cache entry created: iso-price.1.1.0.readme.md')
        sothat('cache reflects installed version')
```

## edge cases

```
given('a scoped package like @ehmpathy/as-command')
  when('readme is requested')
    then('scoped name is handled correctly in cache path')
      sothat('no path traversal or invalid filenames')

given('a package with no readme in npm registry')
  when('readme is requested')
    then('error: "readme not found for $package"')
    then('suggestion to use filetree subcommand is shown')

given('npm api is unreachable')
  when('readme is requested and not in node_modules or cache')
    then('error: "could not fetch readme from npm registry"')
    then('suggestion to check network or use filetree is shown')
```
