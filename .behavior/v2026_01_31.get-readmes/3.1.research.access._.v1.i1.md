# research: remote access for get.package.docs

## remote repositories

### 1. npm registry api

**what**: public api to fetch package metadata (readme content included)

**endpoint**: `https://registry.npmjs.org/{package}/{version}`

**contract**:
- `GET /{package}` → full package metadata (readme for latest version)
- `GET /{package}/{version}` → version-specific metadata (readme for that version)

**response structure** (relevant fields):
```json
{
  "name": "package-name",
  "version": "1.0.0",
  "readme": "full text of README file as pointed to in package.json",
  "readmeFilename": "README.md"
}
```

**citations**:

[1] npm registry docs state the response includes:
> "readme: full text of the latest version's README"
> "readmeFilename: name of the README file"
— [npm/registry package-metadata.md](https://github.com/npm/registry/blob/main/docs/responses/package-metadata.md)

[2] for version-specific endpoint:
> "GET /{package}/{version} - Retrieves metadata for a specific package version"
> "readme: full text of README file as pointed to in package.json"
— [npm/registry REGISTRY-API.md](https://github.com/npm/registry/blob/main/docs/REGISTRY-API.md)

[3] readme size limit:
> "the first 64K of the README data for the most-recently published version of the package"
— [npm/registry package-metadata.md](https://github.com/npm/registry/blob/main/docs/responses/package-metadata.md)

**best practices**:
- use version-specific endpoint `/{package}/{version}` to get readme for installed version
- handle 64K truncation (rare, but possible for huge readmes)
- handle 404 for packages without readme
- no auth required for public packages

### 2. local filesystem (node_modules)

**what**: installed packages may bundle readme.md

**path**: `./node_modules/{package}/README.md` (case-insensitive match)

**contract**:
- file may or may not exist (not all packages bundle readme)
- file may be named `README.md`, `readme.md`, `Readme.md`, etc.

**best practices**:
- check node_modules first (fastest, no network, matches installed version)
- case-insensitive glob for readme file: `README.md`, `readme.md`, `Readme.md`
- if not found, fall back to npm registry api

### 3. local filesystem (cache)

**what**: cached readmes from prior fetches

**path**: `.refs/get.package.docs/{package}.{version}.readme.md`

**contract**:
- file exists if previously fetched from npm registry
- content is the readme text
- filename encodes package name and version

**best practices**:
- check cache before network call
- write to cache after successful npm fetch
- scoped packages: encode `@scope/name` as `@scope__name` or similar (no `/` in filename)
- bootstrap `.gitignore` on first write to keep cache out of git

## access priority order

1. **node_modules** — fastest, offline, matches installed version exactly
2. **cache** — fast, offline, version-aware
3. **npm registry api** — fallback, requires network, cache result

## scoped package handle

scoped packages like `@ehmpathy/as-command`:
- npm api: `https://registry.npmjs.org/@ehmpathy%2Fas-command/1.0.0` (url-encoded)
- node_modules: `./node_modules/@ehmpathy/as-command/README.md`
- cache: `.refs/get.package.docs/@ehmpathy__as-command.1.0.0.readme.md` (safe filename)

## sources

- [npm/registry REGISTRY-API.md](https://github.com/npm/registry/blob/main/docs/REGISTRY-API.md)
- [npm/registry package-metadata.md](https://github.com/npm/registry/blob/main/docs/responses/package-metadata.md)
- [npm docs - about package readme files](https://docs.npmjs.com/about-package-readme-files/)
