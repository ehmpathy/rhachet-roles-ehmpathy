# blackbox criteria matrix: keyrack

## matrix.1 = keyrack init

| ind: keyrack exists | dep: outcome | dep: keyrack state |
|---------------------|--------------|-------------------|
| no | creates `.agent/keyrack.yml` | extends specified role |
| yes | updates keyrack | extends specified role |

✓ complete — 2 combinations, both covered


## matrix.2 = keyrack unlock

| ind: keyrack locked | dep: outcome | dep: session state |
|---------------------|--------------|-------------------|
| yes (locked) | authenticates | unlocked for session |
| no (unlocked) | no-op | remains unlocked |

✓ complete — 2 combinations, both covered (idempotent)


## matrix.3 = keyrack set

| ind: key exists in host manifest | dep: outcome | dep: host manifest state |
|---------------------------------|--------------|-------------------------|
| no | registers key | key added |
| yes | updates key | key updated |

✓ complete — 2 combinations, both covered (idempotent)


## matrix.4 = keyrack get (happy path)

| ind: keyrack extended | ind: keyrack unlocked | ind: key in manifest | dep: outcome |
|-----------------------|-----------------------|----------------------|--------------|
| yes | yes | yes | returns key value |

✓ complete — 1 happy path combination


## matrix.5 = keyrack get (error cases)

| ind: keyrack extended | ind: keyrack unlocked | ind: key in manifest | dep: outcome | dep: error message |
|-----------------------|-----------------------|----------------------|--------------|--------------------|
| no | - | - | fail fast | "ask human to `rhx keyrack init --extends ...`" |
| yes | no | - | fail fast | "ask human to `rhx keyrack unlock`" |
| yes | yes | no | fail fast | "ask human to `rhx keyrack set --key X`" |

✓ complete — 3 error combinations, all covered

note: `-` means "don't care" — earlier conditions short-circuit


## coverage summary

| usecase | dimensions | combinations | gaps |
|---------|------------|--------------|------|
| init | 1 | 2 | none |
| unlock | 1 | 2 | none |
| set | 1 | 2 | none |
| get (happy) | 3 | 1 | none |
| get (error) | 3 | 3 | none |

all matrices are small (≤3 dimensions) — no decomposition needed.
