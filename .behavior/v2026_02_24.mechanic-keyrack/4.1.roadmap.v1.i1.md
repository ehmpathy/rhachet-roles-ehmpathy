# roadmap: keyrack integration

## overview

simple 2-file update: declare key in keyrack.yml, fetch key in git.commit.push.sh.

## phases

### phase.0 = update keyrack.yml

**goal**: declare the github token in the mechanic role's keyrack spec

**steps**:
- [ ] read `src/domain.roles/mechanic/keyrack.yml`
- [ ] add `EHMPATHY_SEATURTLE_PROD_GITHUB_TOKEN` to `env.all`

**acceptance**:
- keyrack.yml declares the key in env.all
- no storage details in the file

**briefs**: none required (declarative yaml change)


### phase.1 = update git.commit.push.sh

**goal**: replace token guard with keyrack fetch

**steps**:
- [ ] read `src/domain.roles/mechanic/skills/git.commit/git.commit.push.sh`
- [ ] find the token guard (around line ~158)
- [ ] replace guard with keyrack fetch:
  ```bash
  # fetch token from keyrack (errors propagate with actionable messages)
  EHMPATHY_SEATURTLE_PROD_GITHUB_TOKEN=$(
    ./node_modules/.bin/rhachet keyrack get \
      --key EHMPATHY_SEATURTLE_PROD_GITHUB_TOKEN
  )
  ```
- [ ] remove old token guard

**acceptance**:
- no `|| true` or fallback
- keyrack errors propagate (not swallowed)
- mechanic unaware of keyrack (invisible infrastructure)

**briefs**: read mechanic standards on fail-fast (rule.forbid.failhide)


### phase.2 = build and verify

**goal**: confirm the changes work

**steps**:
- [ ] run `npm run build`
- [ ] run `npx rhachet roles link --role mechanic`
- [ ] verify skill loads without error

**acceptance**:
- build passes
- skill symlinked to .agent/

**briefs**: none required


## dependencies

```
phase.0 (keyrack.yml)
    ↓
phase.1 (git.commit.push.sh) — depends on key declaration
    ↓
phase.2 (build and verify) — depends on all changes complete
```

## summary

| phase | files | lines changed |
|-------|-------|---------------|
| 0 | keyrack.yml | ~2 |
| 1 | git.commit.push.sh | ~10 |
| 2 | none (verify only) | 0 |

total: 2 files, ~12 lines.
